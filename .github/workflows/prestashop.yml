name: PrestaShop

on: 
    push:
        tags:
            - 'v[0-9]+.[0-9]+.[0-9]+'

permissions:
    contents: read

jobs:
    release:
        runs-on: ubuntu-latest
        steps:
            -   name: Checkout
                uses: actions/checkout@v3

            -   name: Cache Composer dependencies
                uses: actions/cache@v3
                with:
                    path: /tmp/composer-cache
                    key: ${{ runner.os }}-${{ hashFiles('**/composer.lock') }}

            -   name: Install framework dependecies
                uses: php-actions/composer@v6
                with:
                    php_version: 7.4
                    working_dir: framework
                    dev: yes
                    progress: yes

            -   name: Node bootstrap
                uses: actions/setup-node@v3
                with:
                    node-version: 18

            -   run: npm ci

            -   name: Build editor
                run: npm run build

            -   name: Copy dist to prestashop
                run: | 
                    ls ${{ github.workspace }}
                    cp -vr ./editor/client/dist/ ./modules/prestashop/views/

            -   name: Create release artifact
                run: zip release.zip ./modules/prestashop/* -r
                    
            -   name: Upload artifact
                uses: actions/upload-artifact@v3
                with:
                    name: prestashop-${{github.ref_name}}
                    path: release.zip